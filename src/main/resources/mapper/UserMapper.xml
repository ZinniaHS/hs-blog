<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hs.blog.mapper.UserMapper">

    <!-- UserMapper.xml -->
    <select id="getUserInfoById" resultType="com.hs.blog.pojo.vo.UserInfoVO">
        SELECT
        u.id,
        u.username,
        u.email,
        u.avatar_url as avatarUrl,
        u.description,
        u.phone,
        -- 统计用户博客总数
        (SELECT COUNT(*) FROM blog WHERE user_id = u.id) as totalBlogs,
        -- 统计总浏览量（非空时求和，否则返回0）
        COALESCE((SELECT SUM(view_count) FROM blog WHERE user_id = u.id), 0) as totalViews,
        COALESCE((SELECT SUM(like_count) FROM blog WHERE user_id = u.id), 0) as totalLikes,
        COALESCE((SELECT SUM(star_count) FROM blog WHERE user_id = u.id), 0) as totalStars,
        -- 统计关注者数量
        (SELECT COUNT(*) FROM user_follower WHERE user_id = u.id) as totalFollowers
        FROM user u
        WHERE u.id = #{id}
        AND u.is_deleted = 0  <!-- 排除逻辑删除的记录 -->
    </select>
</mapper>